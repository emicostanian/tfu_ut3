worker_processes 1;

events { worker_connections 1024; }

http {
  access_log /var/log/nginx/access.log;
  error_log  /var/log/nginx/error.log warn;

  upstream auth_up      { server auth-api:3000; }
  upstream usuarios_up  { server usuarios-api:3000; }
  upstream proyectos_up { server proyectos-api:3000; }
  upstream tareas_up    { server tareas-api:3000; }

  server {
    listen 80;

    # Health del gateway
    location = /health { return 200 "ok\n"; }

    # Proxies (SIN barra final en proxy_pass)
    location /auth/      { proxy_pass http://auth_up;      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; }
    location /usuarios/  { proxy_pass http://usuarios_up;  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; }
    location /proyectos/ { proxy_pass http://proyectos_up; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; }
    location /tareas/    { proxy_pass http://tareas_up;    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; }

    # Fallback ra√≠z
    location / { return 200 "gateway alive\n"; }
  }
}
